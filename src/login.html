<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="
        default-src 'self'; 
        font-src 'self' https://fonts.gstatic.com; 
        style-src 'self' https://fonts.googleapis.com; 
        script-src 'self' https://cdn.jsdelivr.net https://www.gstatic.com https://www.googleapis.com; 
        connect-src 'self' https://identitytoolkit.googleapis.com https://www.googleapis.com; 
        img-src 'self' data:;"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./login.css" />
    <title>Login & Register</title>
    <style>
      /* CSS pentru tranziții între formulare */
      .form-hidden {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease-in-out, visibility 0s 0.5s;
      }

      .form-visible {
        opacity: 1;
        visibility: visible;
        transition: opacity 0.5s ease-in-out, visibility 0s;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Form de login -->
      <form action="#" id="login-form" class="login-form form-visible">
        <h3>Login</h3>
        <label for="email-input">
          Email
          <input type="email" placeholder="Email" id="email-input" required />
        </label>
        <label for="password-input">
          Password
          <input
            type="password"
            placeholder="Password"
            id="password-input"
            required
          />
        </label>
        <button class="login-btn" type="submit" id="login-btn">Log in</button>
        <div class="social">
          <div class="go" id="google"><a class="fab fa-google"></a>Google</div>
          <div class="fb" id="facebook">
            <a class="fab fa-facebook"></a>Facebook
          </div>
        </div>
        <div class="form">
          <p>
            Don't have an account? <a href="#" id="show-register">Create One</a>
          </p>
        </div>
      </form>

      <!-- Form de înregistrare -->
      <form action="#" id="register-form" class="register-form form-hidden">
        <h3>Register</h3>
        <label for="register-email">
          Email
          <input
            type="email"
            placeholder="Email"
            id="register-email"
            required
          />
        </label>
        <label for="register-password">
          Password
          <input
            type="password"
            placeholder="Password"
            id="register-password"
            required
          />
        </label>
        <button class="login-btn" type="submit" id="register-btn">
          Register
        </button>
        <div class="form">
          <p>Already have an account? <a href="#" id="show-login">Log in</a></p>
        </div>
      </form>
    </div>

    <!-- SweetAlert2 pentru alerte -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>

    <script type="module">
      import { initializeApp } from 'firebase/app';
      import {
        getAuth,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
        onAuthStateChanged,
      } from 'firebase/auth';

      // Configurația Firebase
      const firebaseConfig = {
        apiKey: 'AIzaSyCw7VkecxwaMQ6UI5ymBFqf54FHRi8_Fkc',
        authDomain: 'filmoteka-ef771.firebaseapp.com',
        projectId: 'filmoteka-ef771',
        storageBucket: 'filmoteka-ef771.appspot.com',
        messagingSenderId: '731162565659',
        appId: '1:731162565659:web:da75ae92afc254876bacbe',
        measurementId: 'G-13YE8DDH34',
      };

      // Inițializează aplicația Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // Comută între Login și Register
      document
        .getElementById('show-register')
        .addEventListener('click', event => {
          event.preventDefault();
          document.getElementById('login-form').classList.add('form-hidden');
          document
            .getElementById('login-form')
            .classList.remove('form-visible');
          document
            .getElementById('register-form')
            .classList.remove('form-hidden');
          document
            .getElementById('register-form')
            .classList.add('form-visible');
        });

      document.getElementById('show-login').addEventListener('click', event => {
        event.preventDefault();
        document.getElementById('register-form').classList.add('form-hidden');
        document
          .getElementById('register-form')
          .classList.remove('form-visible');
        document.getElementById('login-form').classList.remove('form-hidden');
        document.getElementById('login-form').classList.add('form-visible');
      });

      // Autentificare utilizator
      document.getElementById('login-btn').addEventListener('click', event => {
        event.preventDefault();
        const email = document.getElementById('email-input').value;
        const password = document.getElementById('password-input').value;

        signInWithEmailAndPassword(auth, email, password)
          .then(userCredential => {
            Swal.fire('Logare reușită!', 'Veți fi redirecționat.', 'success');
            setTimeout(() => {
              window.location.href = 'https://samibumbar.github.io/echipa-2/';
            }, 2000);
          })
          .catch(error => {
            Swal.fire('Eroare la logare', error.message, 'error');
          });
      });

      // Înregistrare utilizator
      document
        .getElementById('register-btn')
        .addEventListener('click', event => {
          event.preventDefault();
          const email = document.getElementById('register-email').value;
          const password = document.getElementById('register-password').value;

          createUserWithEmailAndPassword(auth, email, password)
            .then(userCredential => {
              Swal.fire(
                'Înregistrare reușită!',
                'Acum vă puteți loga.',
                'success'
              );
              setTimeout(() => {
                document
                  .getElementById('register-form')
                  .classList.add('form-hidden');
                document
                  .getElementById('register-form')
                  .classList.remove('form-visible');
                document
                  .getElementById('login-form')
                  .classList.remove('form-hidden');
                document
                  .getElementById('login-form')
                  .classList.add('form-visible');
              }, 2000);
            })
            .catch(error => {
              Swal.fire('Eroare la înregistrare', error.message, 'error');
            });
        });

      // Verificare a autentificării
      onAuthStateChanged(auth, user => {
        if (user) {
          window.location.href = 'https://samibumbar.github.io/echipa-2/';
        }
      });
    </script>
  </body>
</html>
